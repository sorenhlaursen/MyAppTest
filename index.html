<!DOCTYPE html>
<html>
  <head>
    <title>Spongy</title>

    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/functions.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/html5sql.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js" ></script>
    
    
	<script type="text/javascript" charset="utf-8">
	//prepare variables for geo-data
	var geoLatitude;
	var geoLongitude;
	var geoAltitude;
	var geoAccuracy;
	var geoAltitudeAccuracy;
	var geoHeading;
	var geoSpeed;
	var geoTimestamp;
	
    // Wait for Cordova to load
    //
    document.addEventListener("deviceready", onDeviceReady, false);

    // Cordova is ready
    //
    function onDeviceReady() {
		window.setInterval(function(){
			navigator.geolocation.getCurrentPosition(onGeoSuccess, onGeoError);
		}, 500);
    
	
		html5sql.openDatabase("com.zocializr.SpongyDB", "Spongy Database", 3*1024*1024);
				
		html5sql.process(
		     [
		         "DROP TABLE IF EXISTS test;",
		         "CREATE TABLE test (id INTEGER PRIMARY KEY, data TEXT);",
			     "INSERT INTO test (data) VALUES ('One');", 
			     "INSERT INTO test (data) VALUES ('Two');", 
			     "INSERT INTO test (data) VALUES ('Three');", 
			     "INSERT INTO test (data) VALUES ('Four');", 
			     "INSERT INTO test (data) VALUES ('Five');"
		     ],
		     function(){
		         alert("Success creating and inserting into Tables");
		         testDB();
		     },
		     function(error, statement){
		         alert("Error: " + error.message + " when processing " + statement);
		     }        
		 );		
    }

		// FETCH SQL-RESULTS
		function testDB(){
			html5sql.process(
			    ["SELECT * FROM test;"],
			    function(transaction, results, rowsArray){
			    	var outputRows = '';
			      	for(var i = 0; i < rowsArray.length; i++){
			        	//each row in the rowsArray represents a row retrieved from the database
			        	var data = rowsArray[i].data;
			        	outputRows = outputRows +data+ '<br/>';
			      	}
					var output = document.getElementById('output');
			      	output.innerHTML = outputRows;

			    },
			    function(error, statement){
			      //hande error here           
			    }
			);		
		}


    // onSuccess Geolocation
    //
    function onGeoSuccess(position) {
		//Save current position and data
		geoLatitude = position.coords.latitude;
		geoLongitude = position.coords.longitude;
		geoAltitude = position.coords.altitude
		geoAccuracy = position.coords.accuracy;
		geoAltitudeAccuracy = position.coords.altitudeAccuracy;
		geoHeading = position.coords.heading;
		geoSpeed = position.coords.speed;
		geoTimestamp = position.timestamp;
		reportGeoPosition();
    }

    // onError Callback receives a PositionError object
    //
    function onGeoError(error) {
        alert('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
    }
	
	function reportGeoPosition(){
		//post_to_url('http://my.spongy.dk/save_position.php',{'lat':geoLatitude,'long':'432','accu':'2','timestamp':'12.12.12 43:23'});
        var element = document.getElementById('geoData');
        element.innerHTML = 'Latitude: '           + geoLatitude            + '<br />' +
                            'Longitude: '          + geoLongitude           + '<br />' +
                            'Altitude: '           + geoAltitude            + '<br />' +
                            'Accuracy: '           + geoAccuracy            + '<br />' +
                            'Altitude Accuracy: '  + geoAltitudeAccuracy    + '<br />' +
                            'Heading: '            + geoHeading             + '<br />' +
                            'Speed: '              + geoSpeed               + '<br />' +
                            'Timestamp: '          + geoTimestamp			+ '<br />';
		
	}	
	</script>    
  </head>
  <body>
	<p><a href="#" onclick="reportGeoPosition();" style="padding:5px;background:#8cb751;">Report position</a></p>
	<div id="geoData"></div>
	<div><hr></div>
	<div id="output"></div>

  </body>
</html>
