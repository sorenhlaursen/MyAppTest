<!DOCTYPE html>
<html>
  <head>
    <title>Device Properties Example</title>

    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/functions.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/SQLitePlugin.js"></script>
	<script type="text/javascript" charset="utf-8">
	//prepare variables for geo-data
	var geoLatitude;
	var geoLongitude;
	var geoAltitude;
	var geoAccuracy;
	var geoAltitudeAccuracy;
	var geoHeading;
	var geoSpeed;
	var geoTimestamp;
	
    // Wait for Cordova to load
    //
    document.addEventListener("deviceready", onDeviceReady, false);

    // Cordova is ready
    //
    function onDeviceReady() {
		window.setInterval(function(){
			navigator.geolocation.getCurrentPosition(onGeoSuccess, onGeoError);
		}, 500);
		
		var db = window.sqlitePlugin.openDatabase("Spongy", "0.1", "Spongy DB", 200000);
		var consoleOutput = document.getElementById('console');
        element.innerHTML = 
		
		
		db.transaction(function(tx) {
			tx.executeSql('DROP TABLE IF EXISTS myPosition');
			tx.executeSql('CREATE TABLE IF NOT EXISTS myPosition (geoID integer primary key, geoLatitude float, geoLongitude float, geoAltitude float, geoAccuracy integer, timestampLocal integer, timestampServer integer, geoNote text, shareWithFriends boolean, shareWithPublic boolean)');
			tx.executeSql("INSERT INTO myPosition (geoLatitude, geoLongitude) VALUES (?,?)", [55.6477413, 12.2775123], function(tx, res) {
				consoleOutput.innerHTML = 	"insertId: " + res.insertId + " -- probably 1" + 
											"rowsAffected: " + res.rowsAffected + " -- should be 1" +
											"insertId: " + res.insertId + " -- probably 1"+
											"rowsAffected: " + res.rowsAffected + " -- should be 1";
				db.transaction(function(tx) {
					tx.executeSql("select count(geoID) as cnt from myPosition;", [], function(tx, res) {
						consoleOutput.innerHTML = consoleOutput.innerHTML + "res.rows.length: " + res.rows.length + " -- should be 1"+
																			"res.rows.item(0).cnt: " + res.rows.item(0).cnt + " -- should be 1";
					});
				});
			}, function(e) {
				consoleOutput.innerHTML =	"ERROR: " + e.message;
			});
			alert("transaction_done");
		});
    }

    // onSuccess Geolocation
    //
    function onGeoSuccess(position) {
		//Save current position and data
		geoLatitude = position.coords.latitude;
		geoLongitude = position.coords.longitude;
		geoAltitude = position.coords.altitude
		geoAccuracy = position.coords.accuracy;
		geoAltitudeAccuracy = position.coords.altitudeAccuracy;
		geoHeading = position.coords.heading;
		geoSpeed = position.coords.speed;
		geoTimestamp = position.timestamp;
		reportGeoPosition();
    }

    // onError Callback receives a PositionError object
    //
    function onGeoError(error) {
        alert('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
    }
	
	function reportGeoPosition(){
		//post_to_url('http://my.spongy.dk/save_position.php',{'lat':geoLatitude,'long':'432','accu':'2','timestamp':'12.12.12 43:23'});
        var element = document.getElementById('formpost');
        element.innerHTML = 'Latitude: '           + geoLatitude            + '<br />' +
                            'Longitude: '          + geoLongitude           + '<br />' +
                            'Altitude: '           + geoAltitude            + '<br />' +
                            'Accuracy: '           + geoAccuracy            + '<br />' +
                            'Altitude Accuracy: '  + geoAltitudeAccuracy    + '<br />' +
                            'Heading: '            + geoHeading             + '<br />' +
                            'Speed: '              + geoSpeed               + '<br />' +
                            'Timestamp: '          + geoTimestamp			+ '<br />';
		
	}	
	</script>
  </head>
  <body>
	<p><a href="#" onclick="reportGeoPosition();" style="padding:5px;background:#8cb751;">Report position</a></p>
	<div id="formpost"></div>
	<div><img src="http://heltnormalt.dk/img/strip/2012/09/18.jpg" alt="" style="width:90%;"></div>
	<div id="console"></div>
  </body>
</html>
